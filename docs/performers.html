<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJBNRY1Z9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-DJBNRY1Z9M');
    </script>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1" -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="keywords" content="Bach, JSBach, J.S. Bach, BWV1004, BWV 1004, Partita, 2nd Partita, Ciaconna, Chaconne">
    <meta name="author" content="Christophe Thiebaud">

    <!-- HTML Meta Tags -->
    <title>Ciaccona - Performers</title>
    <meta name="description" content="50+ performances of Johann Sebastian Bach's Ciaccona from Partita in D minor for solo violin BWV1004, collated for entertainment and study.">

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Facebook Meta Tags -->
    <meta property="fb:app_id" content="176898451849553">
    <meta property="og:locale" content="en_GB" />
    <meta property="og:site_name" content="ciaccona.cthiebaud.com" />
    <meta property="og:url" content="https://ciaccona.cthiebaud.com/performers.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ciaccona - Performers">
    <meta property="og:description"
        content="50+ performances of Johann Sebastian Bach's Ciaccona from Partita in D minor for solo violin BWV1004, collated for entertainment and study.">
    <meta property="og:image" content="https://ciaccona.cthiebaud.com/screenshots/performers.jpg" />
    <meta property="og:image:url" content="https://ciaccona.cthiebaud.com/screenshots/performers.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1800" />
    <meta property="og:image:height" content="942" />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@cthiebaud">
    <meta property="twitter:domain" content="ciaccona.cthiebaud.com">
    <meta property="twitter:url" content="https://ciaccona.cthiebaud.com/performers.html">
    <meta name="twitter:title" content="Ciaccona - Performers">
    <meta name="twitter:description"
        content="50+ performances of Johann Sebastian Bach's Ciaccona from Partita in D minor for solo violin BWV1004, collated for entertainment and study.">
    <meta name="twitter:image" content="https://ciaccona.cthiebaud.com/screenshots/performers.jpg">

    <!-- Include Handlebars from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <!-- bootstrap -->
    <link rel="stylesheet" href="/lib/bootstrap-5.2.3.min.css">

    <link rel="stylesheet" href="performers.css?v=1.0.4-beta.2">

</head>

<body id="body" class="d-flex flex-column">
    <main id="perfContainer" class="container-xxl">
        <header class="p-2" style="background-color: #f0f0f0; height: 6rem">
            <button id="go-back" type="button" class="btn btn-light m-0 p-0" style="float:right">
                <img src="index.svg?v=1.0.4-beta.2#close-circle-view" style="width:32px; height:32px;">
            </button>
            <h1><span id="performersCount"></span> Performers</h1>
            <p>Views meters were read on <span id="collected"></span>. Pitch detection is approximate.</p>
        </header>
        <div id="perfContainerRow" class="row" style="">
            <div id="perfContainerCol" class="col table-responsive">
                <table id="theTable" class="table table-fit table-striped table-hover table-sm ">
                    <caption style="width:100%" class="caption-top" id="histoWrapper"></caption>
                    <thead>
                        <tr style="font-size:smaller">
                            <th scope="col" id="name" class="name      text-center sortable">
                                <img src="svg/person-male-svgrepo-com.svg" style="width: 22px; height:22px;">
                                <span></span>
                            </th>
                            <th scope="col" class="flag      text-start  sortable">&nbsp;
                                <img src="svg/earth-svgrepo-com.svg" style="width: 22px; height:22px;">
                                <span style="width: 25px;"></span>
                            </th>
                            <th scope="col" class="published text-start  sortable" colspan="2">Published on <span></span></th>
                            <th scope="col" class="views     text-start  sortable">Views <span></span></th>
                            <th scope="col" class="monthly   text-start  sortable" style="min-width: 6rem;">
                                Monthly
                                <span style="float: right;"></span>
                            </th>
                            <th scope="col" class="length    text-start  sortable" style="min-width: 4rem;">
                                <img src="svg/metronome-svgrepo-com.svg" style="width: 22px; height:22px;">
                                <span></span>
                            </th>
                            <th scope="col" class="herz      text-start  sortable" style="min-width: 4rem;">
                                <img src="svg/diapason-svgrepo-com.svg" style="width: 22px; height:22px;">
                                <span></span>
                            </th>
                            <th scope="col" class="yt        text-center">
                                <img src="svg/YouTube_social_white_square_(2017)_white_middle.svg" style="width: 22px; height:22px;">
                                <span></span>
                            </th>
                            <th scope="col" class="still text-start sortable">
                                <img src="svg/picture-svgrepo-com.svg" style="width: 22px; height:22px;">
                                <span style="width: 25px;"></span>
                            </th>
                            <th scope="col" class="fb        text-start  sortable" style="width: 50px;">
                                <img src="svg/info-svgrepo-com.svg" style="width: 22px; height:22px;">
                                <span style="width: 25px;"></span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="theBody">
                    </tbody>
                </table>
            </div>
        </div>
    </main>


    <script id="artist-template" type="text/x-handlebars-template">{{#each this}}        
<tr>
<th class="name" data-lastname="{{reverseFullname}}"><span class="index">{{plusOneZeroPad @index}}</span> <a href={{thisUrl}}>{{hideMe reverseFullname}}</a></th>
<td class="flag text-center">{{flag}}</td>
<td class="published text-end" data-timestamp="{{dateFormat v.publishedMoment "YYMM"}}">{{dateFormat v.publishedMoment "MMMM YYYY"}}</td>
<td class="since">{{humanize v.durationMoment}}</td>
<td class="views     text-end" data-number="{{v.views}}">{{numberFormat v.views}}</td>
<td class="monthly   text-end" data-number="{{v.viewsPerMonth}}">{{numberFormat v.viewsPerMonth}}</td>
<td class="length    text-center">{{v.length}}</td>
<td class="herz      text-center">{{v.a4}}<span style="font-size:10pt;">hz</span></td>
<td class="yt        text-center"><a 
    href={{#if v.youtubeTrueUrl}}{{v.youtubeTrueUrl}}{{else}}{{v.youtubeUrl}}{{/if}}
    target={{fullnameNospaceLowercaseNodiacritics}}>
        {{#if v.trueId}}{{v.trueId}}{{else}}{{v.id}}{{/if}}
    </a></td>
<td class="still text-center">
    {{#if v.still}}
    <img src="svg/picture-svgrepo-com.svg" style="width: 22px; height:22px;">
    {{else}}
    &nbsp;{{/if}}
</td>
<td class="fb        text-center"  data-number="{{#if facebookPost}}{{numberFormat facebookPost.sort}}{{else}}-1{{/if}}">
    {{#if facebookPost}}<sup>{{facebookPost.sort}}</sup>&nbsp;<a href={{facebookPost.url}} target=FB><img src="svg/external-link-svgrepo-com.svg"></a>
    {{else}}
    &nbsp;{{/if}}
</td>
</tr>{{/each}}</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

    <script async type="module">
        import { loadArtists, theDayWhenIReadTheVideoMeters } from "/js/artists.js?v=1.0.4-beta.2"
        import createTimings from "/js/timings.js?v=1.0.4-beta.2"
        import { doHistogram } from '/histogram.js??v=1.0.4-beta.2'
        import moment from 'https://cdn.jsdelivr.net/npm/moment@2.29.4/+esm'
        import fileSaver from 'https://cdn.jsdelivr.net/npm/file-saver@2.0.5/+esm'
        import { formatMilliseconds } from "/js/utils.js?v=1.0.4-beta.2"

        document.getElementById("go-back").addEventListener("click", () => {
            window.location = document.referrer
        });

        document.getElementById("collected").innerHTML = theDayWhenIReadTheVideoMeters.format("D MMMM YYYY")

        const ff = new Intl.NumberFormat()

        Handlebars.registerHelper('dateFormat', function (object, formatting) {
            return object.format(formatting)
        })
        Handlebars.registerHelper('humanize', function (object) {
            return object.humanize()
        })
        Handlebars.registerHelper('numberFormat', function (object) {
            return ff.format(object)
        })
        Handlebars.registerHelper('hideMe', function (object) {
            return object === "Christophe Thiebaud" ? '自分' : object
        })
        Handlebars.registerHelper('sortMeLast', function (object) {
            return object === '自分' ? "~自分" : object
        })
        Handlebars.registerHelper('plusOneZeroPad', function (object) {
            return new String(1 + object).padStart(2, '0')
        })

        const source = document.getElementById("artist-template").innerHTML;
        const template = Handlebars.compile(source);

        const lines = []
        loadArtists().then((theArtists) => {
            theArtists.artists.forEach(a => {
                a.reverseFullname = [a.lastname, a.firstname].filter(Boolean).join(', ');
                a.v = a['▶']
            })
            const sorted = theArtists.artists.sort(sortMoiAlwaysFirst)
            const bodyContent = template(sorted)
            theBody.innerHTML = bodyContent
            document.getElementById('performersCount').innerHTML = sorted.length

            const duration = moment.duration(0);
            let i = 1;
            const durations = []
            const promises = []
            theArtists.artists.forEach(artistObject => {
                try {
                    promises.push(createTimings(artistObject).then((artistAndTimings) => {

                        // console.log(artistAndTimings.duration)
                        duration.add(artistAndTimings.duration)
                        durations.push(
                            {
                                fullname: artistAndTimings.fullname,
                                duration: artistAndTimings.duration.asMilliseconds(),
                                views: artistAndTimings['▶'].views,
                                viewsPerMonth: artistAndTimings['▶'].viewsPerMonth,
                                pitch: artistAndTimings['▶'].a4,
                            }
                        )
                        const mean = duration.asMilliseconds() / i
                        const meanDuration = moment.duration(mean)
                        const lengthAsAString = `${duration.hours()}h${duration.minutes()}m${duration.seconds()}s`
                        const meanAsAString = `${meanDuration.hours()}h${meanDuration.minutes()}m${meanDuration.seconds()}s`
                        // console.log(duration.asSeconds(), lengthAsAString, '| mean:', meanDuration.asMilliseconds(), meanAsAString)
                        const bar256time = Math.floor(artistAndTimings.bars[256].duration.asMilliseconds())
                        const end = Math.floor(bar256time + 12000)
                        const line = `yt-dlp -i "${artistAndTimings.v.youtubeUrl}" --download-section "*${formatMilliseconds(bar256time)}-${formatMilliseconds(end)}" --force-keyframes-at-cuts -o "vids/${artistAndTimings.fullnameNospaceLowercaseNodiacritics}"`
                        lines.push(line)
                    }))

                } catch (error) {
                    console.log('ignore error', error)
                }
            })
            Promise.allSettled(promises).then((results) => {

                results.forEach((result) => {
                    if (result.status === 'rejected') {
                      console.error('Error:', result.reason);
                      // Handle the error as needed
                    }
                });

                /* {
                    // console.log(lines)
                    const blob = new Blob([lines.join('\n')], { type: "text/plain;charset=utf-8" });
                    const path = `___grab_vids.sh`
                    setTimeout(() => {
                        fileSaver.saveAs(blob, path);
                        console.log('[recording] saved to', path)
                    }, 200)
                } */              

                const rect = document.getElementById('histoWrapper').getBoundingClientRect()
                doHistogram({
                    idWrapper: 'histoWrapper',
                    widthWrapper: rect.width,
                    heightWrapper: 300,
                    key: "duration",
                    durations: durations,
                    putainDeArtistsArtists: theArtists.artists,
                    bin: {
                        min: 640000,
                        max: 1100000,
                        width: 10000,
                    }
                    // formatKey: (k) => k,
                })
            });
        })

    </script>

    <script src="performers.js"></script>

</body>

</html>